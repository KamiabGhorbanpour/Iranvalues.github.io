<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700" rel="stylesheet">
  <link href='style.css' rel='stylesheet' type='text/css'>
  <title>Iranvalues Results</title>
  <link rel="icon" type="x-icon" href="icon.png">
  <link rel="shortcut icon" type="x-icon" href="icon.png">
  <meta charset="utf-8">
</head>

<body>
  <h1>Iranvalues</h1>
  <hr>
  <h2 style="text-align:center;">Your Results</h2>

  <div id="axes-results"></div>

  <p style="text-align:center; margin-top: 24px;">
    <a href="index.html">Take the quiz again</a>
  </p>

  <!-- Load axes definition -->
  <script src="axes.js"></script>

  <script>
    // Read stored scores
    const scores = JSON.parse(localStorage.getItem("scores") || "{}");

    function num(x) {
      return Number.isFinite(x) ? x : 0;
    }

    // Because your quiz uses signed multipliers, scores can be negative.
    // We'll compute a "right-side %" using a balanced mapping:
    // diff = (right - left); map to 0..100 via: 50 + (diff / (2*max))*100
    // But we don't know max. So we use a robust fallback:
    // right% = (right / (|left|+|right|)) * 100 if denominator > 0
    function rightPercent(leftKey, rightKey) {
      const L = num(scores[leftKey]);
      const R = num(scores[rightKey]);

      const denom = Math.abs(L) + Math.abs(R);
      if (denom === 0) return 50;

      // If R is positive and L is negative, this naturally pushes right higher, etc.
      const rpct = (Math.abs(R) / denom) * 100;

      // Direction correction:
      // If both are negative, abs() loses direction; we restore direction using (R-L).
      const diff = R - L;
      if (diff < 0) return 100 - rpct;
      return rpct;
    }

    function axisBlock(axis) {
      const r = rightPercent(axis.leftKey, axis.rightKey);
      const l = 100 - r;

      return `
        <div class="axis">
          <div class="axis-title">${axis.title}</div>
          <div class="bar">
            <div class="bar-left" style="width:${l}%"></div>
            <div class="bar-right" style="width:${r}%"></div>
          </div>
          <div class="axis-labels">
            <span>${axis.leftLabel} (${l.toFixed(0)}%)</span>
            <span>${axis.rightLabel} (${r.toFixed(0)}%)</span>
          </div>
        </div>
      `;
    }

    // Render
    const root = document.getElementById("axes-results");
    if (typeof AXES === "undefined") {
      root.innerHTML = "<p style='text-align:center;'>AXES not loaded. Make sure axes.js exists and is linked.</p>";
    } else {
      root.innerHTML = AXES.map(axisBlock).join("");
    }
  </script>

  <!-- Minimal styling if your style.css doesn't include these -->
  <style>
    .axis { margin: 18px 0; }
    .axis-title { font-weight: 700; margin-bottom: 8px; }
    .bar { display:flex; height:18px; border-radius:10px; overflow:hidden; background:#eee; }
    .bar-left { background:#444; }
    .bar-right { background:#999; }
    .axis-labels { display:flex; justify-content:space-between; margin-top:6px; font-size:14px; }
  </style>
</body>
</html>
